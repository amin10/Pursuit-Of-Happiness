<!DOCTYPE html>
<html lang="en">
<head>
  <title>Pursuit of Happiness</title>
  <meta charset="utf-8">
   <meta name="viewport" content="initial-scale=2.0, user-scalable=no">

  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
 <script src="jquery-csv.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">

    <style type="text/css">

    html, body, #wrapper{
    height: 100%;
    width: 100%;
     }
    #map-canvas{
        position: absolute;
        top: 0pt;
        left: 0;
        bottom: 0;
        right: 0;
    }
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDxif6DsCvG0_9W3yYk2XQ4D1NN9VWg2wE">
    </script>
    <script type="text/javascript">
       $( document ).ready(function() {
           active = true;
	   numClicks = 0;
           $("#second").hide();
       });
      function initialize() {
         getMap();
         addClickListener();
      }
        //creates video game interface
      function getMap() {
        var mapOptions = {
          center: { lat: 42.358263, lng: -71.054020},
          zoom: 14
        };
        var map = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);
        return map;
      }

        function process() {
            var coordinates = clicked_coordinates;
            var loc = coordinates[0]
            var des = coordinates[1]
csv = "-76.23961598,39.55583191,0.6135 -75.0444945,39.87785339,1.2618 -73.86491964,40.85757446,1.0144 -80.5324173,37.15205002,1.1702 -76.58813741,39.36404037,0.8065 -81.9179173,41.45532227,0.7717 -73.54996031,45.52656555,1.6959 -83.00617484,39.98804474,1.5418 -77.0174,38.89759827,1.5487 -73.94528444,40.80802155,1.3312 -74.73156894,40.19697189,1.1983 -74.03375752,40.99141312,1.3022 -71.0884,42.3470993,0.7063 -83.0479828,42.32848358,1.2343 -71.43257883,41.84076309,1.9324 -73.6104058,40.75260162,1.3338 -73.976188,40.68326569,0.8519 -74.375369,40.57784653,1.3509 -74.99584481,41.68067551,1.4872 -83.9508068,43.41947174,1.5425 -75.73366667,39.52534485,1.6379 -76.99055978,42.87817383,1.2421 -75.09407663,38.52811432,0.6963 -73.18275154,40.73729324,1.5661 -78.8946569,35.99075317,1.7654 -76.5397568,39.39772034,1.4219 -74.1897707,40.64796448,0.7051 -79.950434,40.46160889,1.4086 -86.13570903,40.47473145,0.7573 -73.92843859,40.68276978,1.1091 -75.180244,39.96523666,1.3504 -83.57040333,41.83816528,1.2278 -77.72006791,39.79776764,0.6438 -73.14508664,41.19104385,0.6402 -83.1266945,40.60202789,1.3348 -72.3922811,40.94838333,0.6514 -74.0256805,40.18880844,1.4866";
  csv = csv.replace("/\r?\n|\r/", "");
  arr = csv.split(",");
  Array.prototype.chunk = function(chunkSize) {
    var array=this;
    return [].concat.apply([],
        array.map(function(elem,i) {
            return i%chunkSize ? [] : [array.slice(i,i+chunkSize)];
        })
    );
  }
      function addClickListener() {
        var map = getMap();
           google.maps.event.addListener(map, 'click', function(event){                                                                                                                                                          

       if (numClicks % 2 == 0 ) {
           startLat = event.latLng.lat();
           startLong = event.latLng.lng()
           numClicks++;
           $("#second").show();
           $("#first").hide();
       } else if (numClicks % 2 == 1) {
           endLat = event.latLng.lat();
           endLong = event.latLng.lng();
           numClicks++;
           clicked_coordinates =[[startLat,startLong],[endLat,endLong]]
           $('#second').html("Here is the happiest route");
           process();
          }
         }); 
      } 
}
    </script>
    <script src = "https://lagrassa.scripts.mit.edu/Pursuit-Of-Happiness/alg.js"> </script>
    <script src = "http://maps.google.com/maps/api/js?v=3.exp&sensor=false"></script> 
<script>
         
      google.maps.event.addDomListener(window, 'load', initialize); 
      addClickListener();
  datapoints = arr.chunk(3);

            //datapoints = $.csv.toArray(csv);
             
               /*var extract = function(){                      
               $(document).ready(function () {        
                 $.ajax({                                                                   
                   type: "GET",                                 
                   url: 'cached_tweets.csv',             
                   dataType: "csv",                                              
                   success: function (raw) {
                   for (row in raw) {                   
                       datapoints.push([row[0], row[1], row[5]])                                              
                       console.log(row);
                   }
                   
                   console.log(datapoints);
                   }                                                                 
                });                                             
              });*/                                                   
                                                                                   
            //extract();
            if(active){
		
		active = false;
	    var points = alg(coordinates[0],coordinates[1], datapoints);
        	console.log(points);
	    displayOnMap(points);
		}

       
	

    function displayOnMap(points) {
        var map = getMap()
    //var points = [[42.3351, -71.1704],[42.3496,-71.0997],[42.3598,-71.0921]];
    var pathCoordinates = [];
    for (var i = 0; i < points.length; i++) {
          pathCoordinates.push(new google.maps.LatLng(points[i][0], points[i][1]));
    }
    var fullBounds = new google.maps.LatLngBounds();
    fullBounds.extend(pathCoordinates[0]);
    fullBounds.extend(pathCoordinates[points.length-1]);
    map.fitBounds(fullBounds);

    var happyPath = new google.maps.Polyline({
      path: pathCoordinates,
      geodesic: true,
      strokeColor: '#FF0000',
      strokeOpacity: 1.0,
      strokeWeight: 2
     });
    happyPath.setMap(map);
    }




 
    </script>
</head>
<body>

<style>
   #wrapper { position: relative; }
   #over_map { position: absolute; top: 10px; left: 10px; z-index: 99; }
</style>

<div id="wrapper">
   <div id="map-canvas">

   </div>

   <div id="over_map">

 <button  type = "button"  id = "first" style= " width:900px; font-size:33; z-index:9; color: black; background: rgba(192,192,200,0.7);" position = "relative"  class="btn btn-primary btn-lg">Click your current location</button>

 <button  type = "button"  id = "second" style= " width:900px; font-size:33; z-index:9; color: black; background: rgba(192,192,200,0.7);" position = "relative"  class="btn btn-primary btn-lg">Click your ultimate destination</button>
   </div>
</div>



</body>

</html>

